name: DOCX to Markdown (minimal)

on:
  push:
    paths:
      - 'incoming/*.docx'
      - '.github/workflows/docx-to-md.yml'

jobs:
  convert-docx:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install pandoc
        run: |
          sudo apt-get update
          sudo apt-get install -y pandoc

      - name: Convert DOCX to Markdown
        run: |
          mkdir -p docs
          for f in incoming/*.docx; do
            base=$(basename "$f" .docx)
            pandoc "$f" -f docx -t gfm -o "docs/${base}.md"
          done

      - name: Commit Markdown back to main
        run: |
          git config user.name "doc-bot"
          git config user.email "doc-bot@example.com"
          git add docs/*.md
          git commit -m "Auto: convert DOCX to Markdown" || echo "No changes to commit"
          git push origin HEAD:main
